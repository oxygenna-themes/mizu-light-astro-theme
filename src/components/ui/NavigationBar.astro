---
// Header - Navigation bar
// ------------
// Description: persistent and accessible navigation bar for primary site navigation.
// Structure:
// - Logo: website logo with light/dark versions and optional text
// - Menu toggle: mobile hamburger toggle for navigation menu
// - Navigation Links: main navigation items with optional submenu
// - Actions: action buttons in the navigation bar
// - Theme Switcher: toggle between light and dark modes

// Components
// - UI
import { Icon } from 'astro-icon/components'
import Switcher from './ModeSwitcher.astro'
import Button from './Button.astro'
import DecorationBorder from './DecorationBorder.astro'

// Content
// - Props
type Props = {
	type?: 'none' | 'transparent' | 'sticky'
}
// -- Page Metadata
const { type = 'sticky' } = Astro.props

// - Data
import { getNavigationBarData } from '../../config/navigationBar'
const navigationBarData = await getNavigationBarData()
const { logo, navItems, navActions } = navigationBarData

// - Determine current path
const path = new URL(Astro.request.url).pathname
function isActivePath(currentPath: string): boolean {
	return path === currentPath || path === `${currentPath}/`
}

// - Type assertion for navActions to ensure type safety
const savedNavActions = navActions.map((action: any) => ({
	...action,
	size: action.size as 'base' | 'lg' | 'sm',
	style: action.style as 'primary' | 'secondary' | 'neutral'
}))
---

<header class:list={['header', { [`header--${type}`]: type }]}>
	<div class="container">
		<nav aria-label="main navigation" role="navigation" class="header__nav">
			{/* Logo */}
			<a href={`/`} class="header__logo">
				<img src={logo.src} alt={logo.alt} width="72" height="72" class="block dark:hidden" />
				<img src={logo.srcDark} alt={logo.alt} width="72" height="72" class="hidden dark:block" />
				{logo.text && <span>{logo.text}</span>}
			</a>

			{/* Menu toggle */}
			<button
				id="header-toggle"
				class="header__toggle group/toggle"
				aria-expanded="false"
				aria-label="Toggle navigation"
			>
				<div class="header__toggle-inner">
					<span aria-hidden="true"></span>
					<span aria-hidden="true"></span>
					<span aria-hidden="true"></span>
				</div>
			</button>

			{/* Navigation links */}
			<ul role="menubar" aria-label="Select page" class="header__menu peer/menu">
				{
					navItems.map((item) => (
						<li role="none" class="header__menu-item group/menuItem">
							{!item.submenu ? (
								<a
									href={item.link}
									role="menuitem"
									class={`header__menu-link ${isActivePath(item.link) ? 'active' : ''}`}
								>
									{item.name}
								</a>
							) : (
								<span
									role="menuitem"
									class={`header__menu-link ${isActivePath(item.link) ? 'active' : ''}`}
								>
									{item.name}

									<Icon name="plus" class="header__menu-chevron size-sm" />
								</span>
							)}
							{item.submenu && (
								<div class="header__submenu">
									<ul class="header__submenu-inner">
										{item.submenu.map((subItem) => (
											<li role="none" class="header__submenu-item">
												<a
													href={subItem.link}
													role="menuitem"
													class={`header__submenu-link ${isActivePath(subItem.link) ? 'active' : ''}`}
												>
													{subItem.name}
												</a>
											</li>
										))}
										<DecorationBorder type="all" style="dashed" extraClasses="hidden lg:block" />
									</ul>
								</div>
							)}
						</li>
					))
				}
			</ul>

			{/* Navigation action buttons */}
			<div class="header__actions">
				{
					savedNavActions.map((action) => (
						<Button link={action.link} classes="header__action w-full" style="neutral">
							{action.name}
						</Button>
					))
				}
			</div>

			{/* Theme Switcher */}
			<Switcher />

			<DecorationBorder type="bottom left right" style="solid" />
		</nav>
	</div>
	<DecorationBorder type="bottom" style="dashed" />
</header>

<style>
	@reference '../../styles/global.css';
	.header {
		@apply relative top-0 z-20 w-full;
	}
	.header--sticky {
		@apply sticky;
	}
	.header__logo {
		@apply font-body relative flex items-center gap-2 text-2xl;
	}
	.header__nav {
		@apply relative flex h-22 items-stretch justify-between bg-white px-6 font-medium lg:h-[6.25rem] lg:px-8 dark:bg-neutral-950;
	}
	.header__menu {
		@apply invisible absolute top-0 left-0 z-[-1] m-0 mt-22 h-[calc(100vh-5.5rem)] w-full justify-center overflow-hidden overflow-y-auto overscroll-contain bg-white px-6 pt-6 pb-28 text-lg leading-none font-medium opacity-0 transition-[opacity,visibility] duration-300 lg:visible lg:relative lg:top-0 lg:z-0 lg:mx-auto lg:mt-0 lg:flex lg:h-full lg:w-auto lg:items-stretch lg:overflow-visible lg:border-none lg:bg-none lg:px-0 lg:pt-0 lg:pb-0 lg:opacity-100 dark:bg-neutral-950;
	}
	.menu--open {
		@apply visible opacity-100;
	}
	.header__menu-item {
		@apply static m-0 flex cursor-pointer flex-col items-stretch justify-center p-0 has-[>.header\_\_submenu_col]:relative lg:min-w-32 lg:flex-row;
	}
	.header__menu-link {
		@apply relative flex w-full items-center justify-between gap-1 p-0 py-4 text-neutral-500 transition-colors duration-300 hover:text-neutral-950 focus:text-neutral-950 focus:outline-hidden focus-visible:outline-hidden lg:justify-center lg:px-7 lg:py-0 dark:text-neutral-400 dark:hover:text-white dark:focus:text-white [&.active]:text-neutral-950 dark:[&.active]:text-white;
	}
	.header__menu-chevron {
		@apply h-4 w-4 transition-transform group-[.open]/menuItem:rotate-45;
	}
	.header__submenu {
		@apply animate-dropdown top-full right-0 mb-0 hidden border border-neutral-200 bg-[url('/bgs/stripe-gray-light.svg')] bg-size-[38px] bg-fixed p-4 backdrop-blur-[2px] group-[.open]/menuItem:flex lg:absolute lg:divide-x lg:border-t-0 lg:bg-white/80 dark:border-neutral-700 dark:bg-[url('/bgs/stripe-gray-dark.svg')] lg:dark:bg-neutral-950/80;
	}
	.header__submenu-inner {
		@apply relative flex w-full flex-col lg:bg-white lg:dark:bg-neutral-950;
	}
	.header__submenu-item {
		@apply m-0 hidden p-0 group-[.open]/menuItem:block lg:group-[.open]/menuItem:block;
	}
	.header__submenu-link {
		@apply [&.active]:text-primary-950 dark:[&.active]:text-primary-50 py-4 font-normal text-neutral-500 transition-colors duration-300 group-has-[svg]/submenuItem:pl-12 group-[.open]/menuItem:flex hover:text-neutral-950 focus:text-neutral-950 lg:px-7 dark:text-neutral-400 dark:hover:text-neutral-50 dark:focus:text-neutral-50;
	}
	.header__toggle {
		@apply relative order-10 block h-full w-22 self-center lg:hidden [&--open]:visible [&--open]:opacity-100;
	}
	.header__toggle-inner {
		@apply absolute top-1/2 left-1/2 w-6 -translate-x-1/2 -translate-y-1/2 transform;
	}
	.header__toggle-inner span {
		@apply absolute block h-[1.5px] transform rounded-full bg-neutral-950 transition-all duration-300 dark:bg-white;
	}
	.header__toggle-inner span:nth-child(1) {
		@apply w-9/12 -translate-y-2 group-[.toggle--open]/toggle:w-6 group-[.toggle--open]/toggle:translate-y-0 group-[.toggle--open]/toggle:rotate-45;
	}
	.header__toggle-inner span:nth-child(2) {
		@apply w-6 group-[.toggle--open]/toggle:-rotate-45;
	}
	.header__toggle-inner span:nth-child(3) {
		@apply w-1/2 origin-top-left translate-y-2 group-[.toggle--open]/toggle:w-0;
	}
	.header__actions {
		@apply invisible fixed right-0 bottom-0 z-50 order-4 flex w-full items-center border-t border-neutral-200 bg-white px-6 py-4 opacity-0 transition-opacity lg:visible lg:static lg:z-0 lg:w-auto lg:border-t-0 lg:bg-transparent lg:bg-none lg:p-0 lg:opacity-100 dark:border-neutral-700 dark:bg-neutral-950 lg:dark:bg-transparent dark:lg:bg-none;
	}
	.header__action {
		@apply self-center;
	}
	.menu--open ~ .header__actions {
		@apply visible opacity-100 delay-500 duration-700;
	}
</style>
